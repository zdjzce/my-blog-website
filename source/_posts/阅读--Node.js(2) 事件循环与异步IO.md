---
title: 阅读--Node.js(2) 事件循环与异步I/O
date: 2023-08-29 11:36:12
tags:
  - 阅读
  - Node.js
categories:
  - [阅读]
---

> JavaScript 有一个基于事件循环的并发模型，事件循环负责执行代码，收集和处理事件以及执行队列中的子任务，这个模型与其他语言中的模型截然不同。
> 引用自 MDN
这段话讲的是 JavaScript，不是 Node.js。在浏览器中这是针对前端在 DOM 中进行操作的，V8 自己有实现一套事件循环。而 **Node.js 也实现了自己的一套事件循环**。

***

Node.js 作为后端服务运行时，必须得有处理系统事件的能力。去处理各种文件的读写事件，一个最简单的事件循环伪代码：

```js
while (还有事件在监听) {
  const events = 从监听中获取所有事件信息;
  for (const event of events) {
    处理(event);
  }
}
```

一个 `setTimeout` 可以是一个 Timer 事件，一个文件读写是一个系统的** I/O 事件**。其他各大系统平台已经有很成熟的方案。这些方案统称为 I/O 多路复用。

> Node.js 基于 Ryan Dahl 自己开发的 libuv ，完成了自己的事件循环与异步 I/O。


### libuv 的诞生
libuv 是一个聚焦异步 I/O 的跨平台库，他就是为 Node.js 而生的，它抹平了各平台的差异。API 也很简单，包含了文件描述符的监听、读写、连接以及定时器。并且对于各种网络请求也有支持，比如 DNS 查询。


### 事件循环 != 异步 I/O
**事件循环是一种并发模型，本质是一个死循环，在循环中不断处理到来的事件**。而 **异步 I/O 事件只是事件循环中事件的一种。**